## Setup

### Configure your environment
Add the following environment variables to your bash profile for local development and/or your 

.env or Dockerfile for production.

```bash
export REFLEX_API_KEY=...
export REFLEX_APP_NAME=...
export INBOX=https://${REFLEX_APP_NAME}.ds.bhhsresource.com/inbox/
```


### Install HTTPie CLI

The following examples use [httpie](https://httpie.org).  Follow the link for installation instructions.



## Create an application inbox

You can create a inbox for your application by HTTP GET to a new inbox with your API key in the request header.

Note: this first request may take up to 1 minute to return a response while your inbox is created.

```bash
http -v $INBOX x-api-key:$REFLEX_API_KEY
```

**RESPONSE**

```http
GET /inbox/ HTTP/1.1
Host: {REFLEX_APP_NAME}.ds.bhhsresource.com
x-api-key: {REFLEX_API_KEY}

HTTP/1.1 200
Connection: keep-alive
Content-Length: 64
Content-Type: application/json;charset=UTF-8
Date: Mon, 10 Sep 2018 05:20:19 GMT
X-Request-Id: 8bc56b7f-9733-4a7c-a02e-4cf746e7c9f9

{
    "contains": [],
    "id": "https://${REFLEX_APP_NAME}.ds.bhhsresource.com/inbox/"
}
```

## Send a message
Publish inbox messages with HTTP POST.

```bash
http -v POST $INBOX x-api-key:$REFLEX_API_KEY foo=bar
```

**RESPONSE**

```http
POST /inbox/ HTTP/1.1
Accept: application/json, */*
Accept-Encoding: gzip, deflate
Connection: keep-alive
Content-Length: 24
Content-Type: application/json
Host: ${REFLEX_APP_NAME}.ds.bhhsresource.com
User-Agent: HTTPie/0.9.9
x-api-key: ${REFLEX_API_KEY}

{
    "foo": "bar"
}

HTTP/1.1 200
Connection: keep-alive
Content-Length: 2
Content-Type: application/json;charset=UTF-8
Date: Mon, 10 Sep 2018 05:27:22 GMT
X-Request-Id: 7c7a5ace-7ffb-44e9-8950-330ccce929e3

{}
```

## Retrieve messages
To retrieve inbox messages, HTTP GET the inbox URL

```bash
http -v GET $INBOX x-api-key:$REFLEX_API_KEY
```

**RESPONSE**

```json
{
    "id": "https://example.com/inbox/",
    "contains": [
        {
            "id": "https://example.com/inbox/message-id",
            "type": "Notification",
            "timestamp": 1536555268275,
            "instrument": "https://yodata.io/vendor/app",
            "target": "https://example.com/inbox/",
            "object": {
              "foo": "bar"
            }
        }
    ]
}
```
